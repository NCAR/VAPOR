version: 2.1

orbs:
  win: circleci/windows@2.2.0

references:
  workspace_root: &workspace_root
    /tmp/workspace
  attach_workspace: &attach_workspace
    attach_workspace:
      at: *workspace_root

jobs:
  build_centos7_installer:
    docker:
      - image: sgpearse/vapor3-centos7:latest

    steps:
      - checkout

      - run:
          name: cmake3 and make
          command: |
            ls -lrth /usr/local/VAPOR-Deps
            cd /VAPOR
            git checkout master
            git pull
            git checkout $CIRCLE_BRANCH
            cd build
            cmake3 -DCMAKE_BUILD_TYPE:String=Release -DDIST_INSTALLER:string=ON ..
            make
            make installer
            mkdir -p /tmp/installers
            mv *.sh /tmp/installers


      - store_artifacts:
          path: /tmp/installers

workflows:
  build:
    jobs:
      - build_centos7_installer:
          filters:
            branches:
              only: buildCentOSInstaller
